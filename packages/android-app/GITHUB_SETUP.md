# Lotus Android - GitHub Setup Guide

## Overview
This guide will walk you through setting up automated builds and releases for the Lotus Android app using GitHub Actions.

## Prerequisites
- GitHub repository with your code pushed
- Access to repository Settings → Secrets and variables

## Step 1: Generate Signing Keystore

The Android app must be signed before it can be installed on devices. We'll create a keystore and add it to GitHub Secrets.

### Option A: Using the provided script (Recommended)

1. Open a terminal in the `packages/android-app` directory:
   ```bash
   cd packages/android-app
   ```

2. Run the keystore generation script:
   ```bash
   ./generate-keystore.sh
   ```

3. The script will output:
   - A `lotus-release.keystore` file
   - Base64-encoded keystore data
   - Passwords and alias information
   - A `keystore-info.txt` file with all details

4. **Important**: 
   - Keep the `.keystore` file secure
   - Do NOT commit keystore files to git
   - Delete `keystore-info.txt` after adding secrets to GitHub

### Option B: Manual generation

If the script doesn't work, generate manually:

```bash
keytool -genkey -v \
  -keystore lotus-release.keystore \
  -alias lotus \
  -keyalg RSA \
  -keysize 2048 \
  -validity 10000 \
  -storepass YOUR_STORE_PASSWORD \
  -keypass YOUR_KEY_PASSWORD \
  -dname "CN=Lotus, OU=Security, O=Lotus, L=Unknown, ST=Unknown, C=US"
```

Then base64 encode it:
```bash
base64 -i lotus-release.keystore
```

## Step 2: Add GitHub Secrets

Go to your GitHub repository → Settings → Secrets and variables → Actions → New repository secret

Add these 4 secrets:

### 1. SIGNING_KEY
- **Value**: The base64-encoded keystore (long string from the script output)
- **How to get**: Copy the entire base64 output from the script

### 2. KEYSTORE_PASSWORD
- **Value**: The store password generated by the script
- **How to get**: Look for `KEY_STORE_PASSWORD:` in the script output

### 3. KEY_ALIAS
- **Value**: `lotus` (or whatever alias you used)
- **How to get**: From the script output or your manual entry

### 4. KEY_PASSWORD
- **Value**: The key password generated by the script
- **How to get**: Look for `KEY_PASSWORD:` in the script output

## Step 3: Trigger a Build

Once secrets are configured, you can trigger a build in two ways:

### Option A: Push a Git tag (Recommended)

```bash
# Tag format: android-v{version}
git tag android-v0.1.0
git push origin android-v0.1.0
```

This will automatically:
1. Build the APK
2. Sign it with your keystore
3. Create a GitHub Release
4. Upload the APK and checksums

### Option B: Manual trigger

1. Go to GitHub → Actions → Android Build and Release
2. Click "Run workflow"
3. Enter version (e.g., `0.1.0`)
4. Click "Run workflow"

## Step 4: Download and Install

After the build completes:

1. Go to GitHub → Releases
2. Find the latest release
3. Download `app-release.apk`
4. Transfer to your Android device
5. Install (you may need to enable "Install from unknown sources")

## Troubleshooting

### Build fails with "Signing key not found"
- Check that all 4 secrets are added correctly
- Ensure SIGNING_KEY is the complete base64 string (no newlines)

### Build fails with Java version error
- The workflow uses Java 17 (configured in the workflow file)
- No action needed - this is handled automatically

### APK installs but crashes
- Check that the keystore was generated correctly
- Verify all passwords match
- Check the GitHub Actions logs for errors

## Security Notes

1. **Never commit keystore files** - Always use GitHub Secrets
2. **Keep backups** - Save the keystore file and passwords securely
3. **Use the same keystore** for all releases (Android requires this for updates)
4. **Rotate passwords** periodically for security

## Scaleway S3 Configuration

After installing the app, configure S3 sync:

1. Open app → Settings → Sync
2. Enter your Scaleway details:
   - **Endpoint**: `s3.fr-par.scw.cloud` (or your region)
   - **Region**: `auto`
   - **Bucket**: Your bucket name
   - **Access Key**: SCWxxxxxxxxxxxxxxxxxxxx
   - **Secret Key**: Your secret key
3. Enable "Auto Sync"

## Next Steps

- [ ] Test the app on your device
- [ ] Configure S3 sync with Scaleway
- [ ] Enable auto-updater in the app
- [ ] Set up additional authentication (biometric/PIN)

## Support

If you encounter issues:
1. Check GitHub Actions logs for detailed error messages
2. Verify all secrets are correctly entered
3. Ensure the keystore was generated properly
